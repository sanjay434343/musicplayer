<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0"/>
  <title>Tamil Music - Spotify Clone</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      background: #121212;
      color: #ffffff;
      font-family: 'Helvetica Neue', Arial, sans-serif;
      height: 100vh;
      overflow: hidden;
      display: flex;
      flex-direction: column;
    }
    
    /* Top Navigation */
    .top-nav {
      background: #121212;
      padding: 16px 24px;
      border-bottom: 1px solid #282828;
      display: flex;
      align-items: center;
      gap: 16px;
      z-index: 100;
    }
    
    .nav-buttons {
      display: flex;
      gap: 8px;
    }
    
    .nav-btn {
      width: 32px;
      height: 32px;
      border-radius: 50%;
      background: #0a0a0a;
      border: none;
      color: #ffffff;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 18px;
      transition: background 0.2s;
    }
    
    .nav-btn:hover {
      background: #1a1a1a;
    }
    
    .nav-btn:disabled {
      opacity: 0.4;
      cursor: not-allowed;
    }
    
    .language-dropdown {
      position: relative;
    }
    
    .language-select {
      background: #242424;
      border: 1px solid #404040;
      border-radius: 20px;
      padding: 8px 16px;
      color: #ffffff;
      font-size: 14px;
      cursor: pointer;
      min-width: 120px;
      transition: background 0.2s;
    }
    
    .language-select:hover {
      background: #2a2a2a;
    }
    
    .language-select:focus {
      outline: none;
      border-color: #1db954;
    }
    
    .search-bar {
      flex: 1;
      max-width: 400px;
      position: relative;
    }
    
    .search-input {
      width: 100%;
      background: #242424;
      border: none;
      border-radius: 24px;
      padding: 12px 16px 12px 48px;
      color: #ffffff;
      font-size: 14px;
      transition: background 0.2s;
    }
    
    .search-input:focus {
      outline: none;
      background: #2a2a2a;
    }
    
    .search-icon {
      position: absolute;
      left: 16px;
      top: 50%;
      transform: translateY(-50%);
      color: #b3b3b3;
      font-size: 16px;
    }
    
    /* View Toggle */
    .view-toggle {
      display: flex;
      gap: 8px;
      margin-left: auto;
    }
    
    .toggle-btn {
      background: #242424;
      border: 1px solid #404040;
      border-radius: 8px;
      padding: 8px 16px;
      color: #b3b3b3;
      font-size: 12px;
      cursor: pointer;
      transition: all 0.2s;
    }
    
    .toggle-btn.active {
      background: #1db954;
      color: #000000;
      border-color: #1db954;
    }
    
    .toggle-btn:hover {
      color: #ffffff;
    }
    
    /* Main Content */
    .main-content {
      flex: 1;
      display: flex;
      overflow: hidden;
    }
    
    /* Sidebar */
    .sidebar {
      width: 280px;
      background: #121212;
      border-right: 1px solid #282828;
      display: flex;
      flex-direction: column;
    }
    
    .sidebar-header {
      padding: 24px;
      border-bottom: 1px solid #282828;
    }
    
    .logo {
      height: 32px;
      margin-bottom: 20px;
    }
    
    .sidebar-nav {
      padding: 8px 0;
    }
    
    .sidebar-item {
      padding: 12px 24px;
      color: #b3b3b3;
      font-weight: 500;
      font-size: 14px;
      cursor: pointer;
      transition: color 0.2s;
      display: flex;
      align-items: center;
      gap: 16px;
    }
    
    .sidebar-item.active {
      color: #ffffff;
    }
    
    .sidebar-item:hover {
      color: #ffffff;
    }
    
    .sidebar-section {
      border-bottom: 1px solid #282828;
      margin-bottom: 16px;
    }
    
    .sidebar-section-title {
      padding: 16px 24px 8px;
      color: #b3b3b3;
      font-size: 12px;
      font-weight: 600;
      text-transform: uppercase;
    }
    
    /* Main View */
    .main-view {
      flex: 1;
      background: linear-gradient(180deg, #1e3264 0%, #121212 300px);
      overflow-y: auto;
      padding: 24px;
      padding-bottom: 120px;
    }
    
    .playlist-header {
      margin-bottom: 32px;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }
    
    .playlist-title {
      font-size: 48px;
      font-weight: 900;
      margin-bottom: 8px;
    }
    
    .playlist-info {
      flex: 1;
    }
    
    .playlist-meta {
      color: #b3b3b3;
      font-size: 14px;
    }
    
    .playlist-actions {
      display: flex;
      gap: 16px;
      align-items: center;
    }
    
    .play-all-btn {
      width: 56px;
      height: 56px;
      border-radius: 50%;
      background: #1db954;
      border: none;
      color: #000000;
      font-size: 20px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: transform 0.2s, background 0.2s;
    }
    
    .play-all-btn:hover {
      transform: scale(1.04);
      background: #1ed760;
    }
    
    .shuffle-btn, .suggestions-btn {
      background: none;
      border: 2px solid #b3b3b3;
      border-radius: 24px;
      padding: 8px 16px;
      color: #b3b3b3;
      cursor: pointer;
      font-size: 14px;
      font-weight: 600;
      transition: all 0.2s;
    }
    
    .shuffle-btn:hover, .suggestions-btn:hover {
      border-color: #ffffff;
      color: #ffffff;
    }
    
    /* Content Grid */
    .content-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
      gap: 24px;
      margin-bottom: 32px;
    }
    
    .card {
      background: #181818;
      border-radius: 8px;
      padding: 16px;
      cursor: pointer;
      transition: background 0.2s;
      position: relative;
    }
    
    .card:hover {
      background: #282828;
    }
    
    .card-image {
      width: 100%;
      aspect-ratio: 1;
      border-radius: 8px;
      object-fit: cover;
      margin-bottom: 16px;
      background: #282828;
    }
    
    .card-title {
      font-size: 16px;
      font-weight: 600;
      margin-bottom: 8px;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }
    
    .card-subtitle {
      font-size: 14px;
      color: #b3b3b3;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }
    
    .card-play-btn {
      position: absolute;
      bottom: 24px;
      right: 24px;
      width: 48px;
      height: 48px;
      background: #1db954;
      border: none;
      border-radius: 50%;
      color: #000;
      font-size: 16px;
      cursor: pointer;
      display: none;
      align-items: center;
      justify-content: center;
      transition: transform 0.2s;
    }
    
    .card:hover .card-play-btn {
      display: flex;
    }
    
    .card-play-btn:hover {
      transform: scale(1.05);
    }
    
    /* Songs Table */
    .songs-table {
      width: 100%;
    }
    
    .songs-header {
      display: grid;
      grid-template-columns: 16px 1fr 1fr auto;
      gap: 16px;
      padding: 8px 16px;
      border-bottom: 1px solid #282828;
      margin-bottom: 16px;
      font-size: 12px;
      color: #b3b3b3;
      font-weight: 500;
      text-transform: uppercase;
    }
    
    .song-row {
      display: grid;
      grid-template-columns: 16px 1fr 1fr auto;
      gap: 16px;
      padding: 8px 16px;
      border-radius: 4px;
      cursor: pointer;
      transition: background 0.2s;
      align-items: center;
      min-height: 56px;
    }
    
    .song-row:hover {
      background: #1a1a1a;
    }
    
    .song-row.active {
      background: #1a1a1a;
    }
    
    .song-row.playing .song-name {
      color: #1db954;
    }
    
    .song-index {
      color: #b3b3b3;
      font-size: 14px;
      text-align: center;
    }
    
    .song-row:hover .song-index {
      display: none;
    }
    
    .song-row:hover .play-icon {
      display: block;
    }
    
    .play-icon {
      display: none;
      color: #ffffff;
      font-size: 16px;
      text-align: center;
    }
    
    .song-info {
      display: flex;
      align-items: center;
      gap: 12px;
    }
    
    .song-cover-small {
      width: 40px;
      height: 40px;
      border-radius: 4px;
      object-fit: cover;
      background: #282828;
    }
    
    .song-details {
      min-width: 0;
    }
    
    .song-name {
      font-size: 16px;
      font-weight: 500;
      color: #ffffff;
      margin-bottom: 2px;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }
    
    .song-artist {
      font-size: 14px;
      color: #b3b3b3;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }
    
    .song-album {
      color: #b3b3b3;
      font-size: 14px;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }
    
    .song-duration {
      color: #b3b3b3;
      font-size: 14px;
    }
    
    .load-more-container {
      display: flex;
      justify-content: center;
      margin: 32px 0;
    }
    
    .load-more-btn {
      background: none;
      border: 2px solid #b3b3b3;
      border-radius: 24px;
      padding: 12px 32px;
      color: #b3b3b3;
      cursor: pointer;
      font-size: 14px;
      font-weight: 600;
      transition: all 0.2s;
    }
    
    .load-more-btn:hover {
      border-color: #ffffff;
      color: #ffffff;
      transform: scale(1.02);
    }
    
    .load-more-btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }
    
    /* Section Headers */
    .section-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 16px;
    }
    
    .section-title {
      font-size: 24px;
      font-weight: 700;
    }
    
    .section-link {
      color: #b3b3b3;
      font-size: 14px;
      cursor: pointer;
      font-weight: 600;
      transition: color 0.2s;
    }
    
    .section-link:hover {
      color: #ffffff;
    }
    
    /* Bottom Player */
    .bottom-player {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      background: #181818;
      border-top: 1px solid #282828;
      padding: 12px 16px;
      display: grid;
      grid-template-columns: 1fr 2fr 1fr;
      gap: 16px;
      align-items: center;
      z-index: 1000;
      height: 90px;
    }
    
    .now-playing {
      display: flex;
      align-items: center;
      gap: 12px;
      min-width: 0;
    }
    
    .now-playing-cover {
      width: 56px;
      height: 56px;
      border-radius: 4px;
      object-fit: cover;
      background: #282828;
      flex-shrink: 0;
    }
    
    .now-playing-info {
      min-width: 0;
      flex: 1;
    }
    
    .now-playing-name {
      font-size: 14px;
      font-weight: 500;
      color: #ffffff;
      margin-bottom: 2px;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }
    
    .now-playing-artist {
      font-size: 12px;
      color: #b3b3b3;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }
    
    .like-btn {
      background: none;
      border: none;
      color: #b3b3b3;
      cursor: pointer;
      padding: 8px;
      margin-left: 8px;
      border-radius: 50%;
      transition: color 0.2s;
    }
    
    .like-btn:hover {
      color: #ffffff;
    }
    
    .like-btn.liked {
      color: #1db954;
    }
    
    .player-controls {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 8px;
    }
    
    .control-buttons {
      display: flex;
      align-items: center;
      gap: 16px;
    }
    
    .control-btn {
      background: none;
      border: none;
      color: #b3b3b3;
      cursor: pointer;
      padding: 8px;
      border-radius: 50%;
      transition: color 0.2s, transform 0.2s;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    .control-btn:hover {
      color: #ffffff;
      transform: scale(1.06);
    }
    
    .play-pause-btn {
      width: 32px;
      height: 32px;
      background: #ffffff;
      color: #000000;
      font-size: 12px;
    }
    
    .play-pause-btn:hover {
      background: #ffffff;
      color: #000000;
      transform: scale(1.06);
    }
    
    .progress-bar {
      display: flex;
      align-items: center;
      gap: 8px;
      width: 100%;
      max-width: 600px;
    }
    
    .time-display {
      font-size: 11px;
      color: #b3b3b3;
      min-width: 40px;
      text-align: center;
    }
    
    .progress-track {
      flex: 1;
      height: 4px;
      background: #4f4f4f;
      border-radius: 2px;
      cursor: pointer;
      position: relative;
    }
    
    .progress-filled {
      height: 100%;
      background: #ffffff;
      border-radius: 2px;
      width: 0%;
      transition: width 0.1s;
    }
    
    .volume-controls {
      display: flex;
      align-items: center;
      gap: 8px;
      justify-self: end;
    }
    
    .volume-btn {
      background: none;
      border: none;
      color: #b3b3b3;
      cursor: pointer;
      padding: 8px;
    }
    
    .volume-slider {
      width: 100px;
      height: 4px;
      background: #4f4f4f;
      border-radius: 2px;
      cursor: pointer;
      position: relative;
    }
    
    .volume-filled {
      height: 100%;
      background: #ffffff;
      border-radius: 2px;
      width: 75%;
    }
    
    .loading {
      display: flex;
      justify-content: center;
      align-items: center;
      height: 200px;
      color: #b3b3b3;
      flex-direction: column;
      gap: 16px;
    }
    
    .loading-spinner {
      width: 32px;
      height: 32px;
      border: 3px solid #333;
      border-top: 3px solid #1db954;
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }
    
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    
    .error {
      display: flex;
      justify-content: center;
      align-items: center;
      height: 200px;
      color: #f77;
      flex-direction: column;
      gap: 12px;
    }
    
    .error-title {
      font-size: 18px;
      font-weight: 600;
    }
    
    .error-message {
      font-size: 14px;
      color: #b3b3b3;
    }
    
    /* Responsive */
    @media (max-width: 768px) {
      .sidebar {
        display: none;
      }
      
      .bottom-player {
        grid-template-columns: 1fr auto;
      }
      
      .volume-controls {
        display: none;
      }
      
      .playlist-header {
        flex-direction: column;
        align-items: flex-start;
        gap: 16px;
      }
      
      .playlist-title {
        font-size: 32px;
      }
      
      .content-grid {
        grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
        gap: 16px;
      }
    }
    
    /* Scrollbar */
    ::-webkit-scrollbar {
      width: 12px;
    }
    
    ::-webkit-scrollbar-track {
      background: #121212;
    }
    
    ::-webkit-scrollbar-thumb {
      background: #333333;
      border-radius: 6px;
    }
    
    ::-webkit-scrollbar-thumb:hover {
      background: #444444;
    }
    
    /* Hidden */
    .hidden {
      display: none;
    }
  </style>
</head>
<body>
  <!-- Top Navigation -->
  <nav class="top-nav">
    <div class="nav-buttons">
      <button class="nav-btn" onclick="history.back()" title="Go back">‚Äπ</button>
      <button class="nav-btn" onclick="history.forward()" title="Go forward">‚Ä∫</button>
    </div>
    
    <div class="language-dropdown">
      <select class="language-select" id="languageSelect">
        <option value="tamil">Tamil</option>
        <option value="hindi">Hindi</option>
        <option value="telugu">Telugu</option>
        <option value="malayalam">Malayalam</option>
        <option value="kannada">Kannada</option>
        <option value="bengali">Bengali</option>
        <option value="punjabi">Punjabi</option>
        <option value="marathi">Marathi</option>
        <option value="gujarati">Gujarati</option>
        <option value="english">English</option>
      </select>
    </div>
    
    <div class="search-bar">
      <span class="search-icon">üîç</span>
      <input type="text" class="search-input" id="searchInput" placeholder="Search for songs, artists, or albums">
    </div>
    
    <div class="view-toggle">
      <button class="toggle-btn active" id="songsToggle" onclick="switchView('songs')">Songs</button>
      <button class="toggle-btn" id="albumsToggle" onclick="switchView('albums')">Albums</button>
      <button class="toggle-btn" id="artistsToggle" onclick="switchView('artists')">Artists</button>
      <button class="toggle-btn" id="playlistsToggle" onclick="switchView('playlists')">Playlists</button>
    </div>
  </nav>

  <!-- Main Content -->
  <div class="main-content">
    <!-- Sidebar -->
    <div class="sidebar">
      <div class="sidebar-header">
        <img src="https://storage.googleapis.com/pr-newsroom-wp/1/2018/11/Spotify_Logo_CMYK_White.png" alt="Spotify" class="logo">
      </div>
      <nav class="sidebar-nav">
        <div class="sidebar-section">
          <div class="sidebar-item active" onclick="switchView('songs')">
            <span>üè†</span> Home
          </div>
          <div class="sidebar-item" onclick="showSearch()">
            <span>üîç</span> Search
          </div>
          <div class="sidebar-item" onclick="showLibrary()">
            <span>üìö</span> Your Library
          </div>
        </div>
        
        <div class="sidebar-section">
          <div class="sidebar-section-title">Recently Played</div>
          <div id="recentlyPlayedList"></div>
        </div>
        
        <div class="sidebar-section">
          <div class="sidebar-section-title">Liked Songs</div>
          <div id="likedSongsList"></div>
        </div>
      </nav>
    </div>

    <!-- Main View -->
    <div class="main-view" id="mainView">
      <!-- Songs View -->
      <div id="songsView" class="view-content">
        <div class="playlist-header">
          <div class="playlist-info">
            <h1 class="playlist-title" id="playlistTitle">Tamil Songs</h1>
            <div class="playlist-meta">
              <span id="songsCount">Loading...</span> songs ‚Ä¢ Made for you
            </div>
          </div>
          <div class="playlist-actions">
            <button class="play-all-btn" onclick="playAll()" title="Play all">‚ñ∂</button>
            <button class="shuffle-btn" onclick="shuffleAll()">Shuffle play</button>
            <button class="suggestions-btn" onclick="loadSuggestions()">Get Suggestions</button>
          </div>
        </div>

        <div class="songs-table">
          <div class="songs-header">
            <span>#</span>
            <span>Title</span>
            <span>Album</span>
            <span>‚è±</span>
          </div>
          <div id="songsList"></div>
        </div>
        
        <div class="load-more-container" id="loadMoreContainer" style="display: none;">
          <button class="load-more-btn" id="loadMoreBtn" onclick="loadMoreSongs()">Load More Songs</button>
        </div>
      </div>

      <!-- Albums View -->
      <div id="albumsView" class="view-content hidden">
        <div class="section-header">
          <h2 class="section-title" id="albumsTitle">Popular Albums</h2>
        </div>
        <div class="content-grid" id="albumsGrid"></div>
        <div class="load-more-container" id="loadMoreAlbumsContainer" style="display: none;">
          <button class="load-more-btn" id="loadMoreAlbumsBtn" onclick="loadMoreAlbums()">Load More Albums</button>
        </div>
      </div>

      <!-- Artists View -->
      <div id="artistsView" class="view-content hidden">
        <div class="section-header">
          <h2 class="section-title" id="artistsTitle">Popular Artists</h2>
        </div>
        <div class="content-grid" id="artistsGrid"></div>
        <div class="load-more-container" id="loadMoreArtistsContainer" style="display: none;">
          <button class="load-more-btn" id="loadMoreArtistsBtn" onclick="loadMoreArtists()">Load More Artists</button>
        </div>
      </div>

      <!-- Playlists View -->
      <div id="playlistsView" class="view-content hidden">
        <div class="section-header">
          <h2 class="section-title" id="playlistsTitle">Popular Playlists</h2>
        </div>
        <div class="content-grid" id="playlistsGrid"></div>
        <div class="load-more-container" id="loadMorePlaylistsContainer" style="display: none;">
          <button class="load-more-btn" id="loadMorePlaylistsBtn" onclick="loadMorePlaylists()">Load More Playlists</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Bottom Player -->
  <div class="bottom-player" id="bottomPlayer" style="display: none;">
    <div class="now-playing">
      <img class="now-playing-cover" id="nowPlayingCover" src="" alt="">
      <div class="now-playing-info">
        <div class="now-playing-name" id="nowPlayingName">Select a song</div>
        <div class="now-playing-artist" id="nowPlayingArtist">Artist</div>
      </div>
      <button class="like-btn" id="likeBtn" onclick="toggleLike()" title="Add to Liked Songs">‚ô°</button>
    </div>

    <div class="player-controls">
      <div class="control-buttons">
        <button class="control-btn" onclick="toggleShuffle()" title="Shuffle" id="shuffleBtn">üîÄ</button>
        <button class="control-btn" onclick="prevSong()" title="Previous">‚èÆ</button>
        <button class="control-btn play-pause-btn" id="playPauseBtn" onclick="togglePlay()">‚ñ∂</button>
        <button class="control-btn" onclick="nextSong()" title="Next">‚è≠</button>
        <button class="control-btn" onclick="toggleRepeat()" title="Repeat" id="repeatBtn">üîÅ</button>
      </div>
      <div class="progress-bar">
        <span class="time-display" id="currentTime">0:00</span>
        <div class="progress-track" onclick="seek(event)">
          <div class="progress-filled" id="progressFilled"></div>
        </div>
        <span class="time-display" id="totalTime">0:00</span>
      </div>
    </div>

    <div class="volume-controls">
      <button class="volume-btn" onclick="toggleMute()">üîä</button>
      <div class="volume-slider" onclick="setVolume(event)">
        <div class="volume-filled" id="volumeFilled"></div>
      </div>
    </div>
  </div>

  <audio id="audioPlayer" style="display: none;"></audio>

  <script>
    const BASE_API_URL = "https://jiosavan-api-with-playlist.vercel.app/api";
    
    // App State
    let appState = {
      songs: [],
      albums: [],
      artists: [],
      playlists: [],
      currentView: 'songs',
      currentIdx: 0,
      isPlaying: false,
      audio: null,
      currentLanguage: 'tamil',
      isShuffled: false,
      repeatMode: 0, // 0: off, 1: all, 2: one
      volume: 0.75,
      isMuted: false,
      searchQuery: '',
      currentPage: {
        songs: 0,
        albums: 0,
        artists: 0,
        playlists: 0
      },
      likedSongs: [],
      recentSongs: [],
      currentPlaylist: null
    };

    // DOM Elements
    const elements = {
      searchInput: document.getElementById("searchInput"),
      languageSelect: document.getElementById("languageSelect"),
      bottomPlayer: document.getElementById("bottomPlayer"),
      nowPlayingCover: document.getElementById("nowPlayingCover"),
      nowPlayingName: document.getElementById("nowPlayingName"),
      nowPlayingArtist: document.getElementById("nowPlayingArtist"),
      playPauseBtn: document.getElementById("playPauseBtn"),
      currentTime: document.getElementById("currentTime"),
      totalTime: document.getElementById("totalTime"),
      progressFilled: document.getElementById("progressFilled"),
      volumeFilled: document.getElementById("volumeFilled"),
      songsCount: document.getElementById("songsCount"),
      playlistTitle: document.getElementById("playlistTitle"),
      likeBtn: document.getElementById("likeBtn"),
      shuffleBtn: document.getElementById("shuffleBtn"),
      repeatBtn: document.getElementById("repeatBtn"),
      songsList: document.getElementById("songsList"),
      albumsGrid: document.getElementById("albumsGrid"),
      artistsGrid: document.getElementById("artistsGrid"),
      playlistsGrid: document.getElementById("playlistsGrid"),
      recentlyPlayedList: document.getElementById("recentlyPlayedList"),
      likedSongsList: document.getElementById("likedSongsList")
    };

    // Initialize app
    document.addEventListener('DOMContentLoaded', function() {
      initializeApp();
    });

    function initializeApp() {
      setupEventListeners();
      loadDefaultContent();
    }

    function setupEventListeners() {
      // Language change
      elements.languageSelect.addEventListener('change', function() {
        appState.currentLanguage = this.value;
        elements.playlistTitle.textContent = `${this.options[this.selectedIndex].text} Songs`;
        resetAndLoadContent();
      });

      // Search with debouncing
      let searchTimeout;
      elements.searchInput.addEventListener('input', function() {
        clearTimeout(searchTimeout);
        appState.searchQuery = this.value.trim();
        searchTimeout = setTimeout(() => {
          if (appState.searchQuery) {
            performSearch(appState.searchQuery);
          } else {
            loadDefaultContent();
          }
        }, 500);
      });

      // Volume controls
      elements.volumeFilled.style.width = (appState.volume * 100) + '%';
    }

    function resetAndLoadContent() {
      appState.currentPage = { songs: 0, albums: 0, artists: 0, playlists: 0 };
      appState.songs = [];
      appState.albums = [];
      appState.artists = [];
      appState.playlists = [];
      loadDefaultContent();
    }

    function loadDefaultContent() {
      switch (appState.currentView) {
        case 'songs':
          loadSongs();
          break;
        case 'albums':
          loadAlbums();
          break;
        case 'artists':
          loadArtists();
          break;
        case 'playlists':
          loadPlaylists();
          break;
      }
    }

    // API Functions with proper error handling
    async function performSearch(query) {
      try {
        const response = await fetch(`${BASE_API_URL}/search?query=${encodeURIComponent(query)}`);
        const data = await response.json();
        
        if (data.success && data.data) {
          // Update all content types with search results
          if (data.data.songs && data.data.songs.results) {
            appState.songs = data.data.songs.results.filter(song => 
              !appState.currentLanguage || 
              song.language === appState.currentLanguage
            );
          }
          
          if (data.data.albums && data.data.albums.results) {
            appState.albums = data.data.albums.results.filter(album => 
              !appState.currentLanguage || 
              album.language === appState.currentLanguage
            );
          }
          
          if (data.data.artists && data.data.artists.results) {
            appState.artists = data.data.artists.results;
          }
          
          if (data.data.playlists && data.data.playlists.results) {
            appState.playlists = data.data.playlists.results.filter(playlist => 
              !appState.currentLanguage || 
              playlist.language === appState.currentLanguage
            );
          }
          
          // Display results based on current view
          displayCurrentView();
        }
      } catch (error) {
        console.error('Search error:', error);
        showError('Failed to search. Please try again.');
      }
    }

    async function loadSongs(append = false) {
      try {
        if (!append) showLoading('songsList');
        
        const query = appState.searchQuery || getRandomQuery('songs');
        const url = `${BASE_API_URL}/search/songs?query=${encodeURIComponent(query)}&limit=50&page=${appState.currentPage.songs}`;
        
        const response = await fetch(url);
        const data = await response.json();
        
        if (data.success && data.data && data.data.results) {
          const newSongs = data.data.results.filter(song => 
            !appState.currentLanguage || 
            song.language === appState.currentLanguage
          );
          
          if (append) {
            appState.songs = [...appState.songs, ...newSongs];
          } else {
            appState.songs = newSongs;
          }
          
          displaySongs();
          appState.currentPage.songs++;
          updateLoadMoreButton('songs', newSongs.length > 0);
        } else {
          throw new Error('No songs found');
        }
      } catch (error) {
        console.error('Error loading songs:', error);
        showError('Failed to load songs', 'songsList');
      }
    }

    async function loadAlbums(append = false) {
      try {
        if (!append) showLoading('albumsGrid');
        
        const query = appState.searchQuery || getRandomQuery('albums');
        const url = `${BASE_API_URL}/search/albums?query=${encodeURIComponent(query)}&limit=20&page=${appState.currentPage.albums}`;
        
        const response = await fetch(url);
        const data = await response.json();
        
        if (data.success && data.data && data.data.results) {
          const newAlbums = data.data.results.filter(album => 
            !appState.currentLanguage || 
            album.language === appState.currentLanguage
          );
          
          if (append) {
            appState.albums = [...appState.albums, ...newAlbums];
          } else {
            appState.albums = newAlbums;
          }
          
          displayAlbums();
          appState.currentPage.albums++;
          updateLoadMoreButton('albums', newAlbums.length > 0);
        } else {
          throw new Error('No albums found');
        }
      } catch (error) {
        console.error('Error loading albums:', error);
        showError('Failed to load albums', 'albumsGrid');
      }
    }

    async function loadArtists(append = false) {
      try {
        if (!append) showLoading('artistsGrid');
        
        const query = appState.searchQuery || getRandomQuery('artists');
        const url = `${BASE_API_URL}/search/artists?query=${encodeURIComponent(query)}&limit=20&page=${appState.currentPage.artists}`;
        
        const response = await fetch(url);
        const data = await response.json();
        
        if (data.success && data.data && data.data.results) {
          const newArtists = data.data.results;
          
          if (append) {
            appState.artists = [...appState.artists, ...newArtists];
          } else {
            appState.artists = newArtists;
          }
          
          displayArtists();
          appState.currentPage.artists++;
          updateLoadMoreButton('artists', newArtists.length > 0);
        } else {
          throw new Error('No artists found');
        }
      } catch (error) {
        console.error('Error loading artists:', error);
        showError('Failed to load artists', 'artistsGrid');
      }
    }

    async function loadPlaylists(append = false) {
      try {
        if (!append) showLoading('playlistsGrid');
        
        const query = appState.searchQuery || getRandomQuery('playlists');
        const url = `${BASE_API_URL}/search/playlists?query=${encodeURIComponent(query)}&limit=20&page=${appState.currentPage.playlists}`;
        
        const response = await fetch(url);
        const data = await response.json();
        
        if (data.success && data.data && data.data.results) {
          const newPlaylists = data.data.results.filter(playlist => 
            !appState.currentLanguage || 
            playlist.language === appState.currentLanguage
          );
          
          if (append) {
            appState.playlists = [...appState.playlists, ...newPlaylists];
          } else {
            appState.playlists = newPlaylists;
          }
          
          displayPlaylists();
          appState.currentPage.playlists++;
          updateLoadMoreButton('playlists', newPlaylists.length > 0);
        } else {
          throw new Error('No playlists found');
        }
      } catch (error) {
        console.error('Error loading playlists:', error);
        showError('Failed to load playlists', 'playlistsGrid');
      }
    }

    // Load playlist songs - this is the key functionality you requested
    async function loadPlaylistSongs(playlistId) {
      try {
        showLoading('songsList');
        const url = `${BASE_API_URL}/playlists?id=${playlistId}`;
        
        const response = await fetch(url);
        const data = await response.json();
        
        if (data.success && data.data && data.data.songs) {
          appState.songs = data.data.songs;
          appState.currentPlaylist = data.data;
          switchView('songs');
          elements.playlistTitle.textContent = data.data.name;
          displaySongs();
        } else {
          throw new Error('Failed to load playlist songs');
        }
      } catch (error) {
        console.error('Error loading playlist songs:', error);
        showError('Failed to load playlist songs', 'songsList');
      }
    }

    // Load album songs
    async function loadAlbumSongs(albumId) {
      try {
        showLoading('songsList');
        const url = `${BASE_API_URL}/albums?ids=${albumId}`;
        
        const response = await fetch(url);
        const data = await response.json();
        
        if (data.success && data.data && data.data[0] && data.data[0].songs) {
          appState.songs = data.data[0].songs;
          switchView('songs');
          elements.playlistTitle.textContent = data.data[0].name;
          displaySongs();
        } else {
          throw new Error('Failed to load album songs');
        }
      } catch (error) {
        console.error('Error loading album songs:', error);
        showError('Failed to load album songs', 'songsList');
      }
    }

    // Load artist songs
    async function loadArtistSongs(artistId) {
      try {
        showLoading('songsList');
        const url = `${BASE_API_URL}/artists/${artistId}/songs?limit=50`;
        
        const response = await fetch(url);
        const data = await response.json();
        
        if (data.success && data.data && data.data.songs) {
          appState.songs = data.data.songs;
          switchView('songs');
          elements.playlistTitle.textContent = 'Artist Songs';
          displaySongs();
        } else {
          throw new Error('Failed to load artist songs');
        }
      } catch (error) {
        console.error('Error loading artist songs:', error);
        showError('Failed to load artist songs', 'songsList');
      }
    }

    // Load suggestions for current song
    async function loadSuggestions() {
      if (!appState.songs.length || appState.currentIdx >= appState.songs.length) return;
      
      try {
        const currentSong = appState.songs[appState.currentIdx];
        const url = `${BASE_API_URL}/songs/${currentSong.id}/suggestions?limit=20`;
        
        const response = await fetch(url);
        const data = await response.json();
        
        if (data.success && data.data) {
          const suggestions = data.data.filter(song => 
            !appState.songs.some(existingSong => existingSong.id === song.id)
          );
          
          appState.songs = [...appState.songs, ...suggestions];
          displaySongs();
        }
      } catch (error) {
        console.error('Error loading suggestions:', error);
      }
    }

    // Display Functions
    function displayCurrentView() {
      switch (appState.currentView) {
        case 'songs':
          displaySongs();
          break;
        case 'albums':
          displayAlbums();
          break;
        case 'artists':
          displayArtists();
          break;
        case 'playlists':
          displayPlaylists();
          break;
      }
    }

    function displaySongs() {
      elements.songsList.innerHTML = "";
      elements.songsCount.textContent = appState.songs.length;
      
      appState.songs.forEach((song, idx) => {
        const songRow = document.createElement("div");
        songRow.className = "song-row" + (idx === appState.currentIdx && appState.isPlaying ? " active playing" : "");
        songRow.onclick = () => playSong(idx);
        
        // Get proper image URL
        const imageUrl = getImageUrl(song.image, '150x150');
        const artistNames = song.artists && song.artists.primary 
          ? song.artists.primary.map(a => a.name).join(", ")
          : song.primaryArtists || 'Unknown Artist';
        const albumName = song.album && song.album.name ? song.album.name : 'Unknown Album';
        
        songRow.innerHTML = `
          <div class="song-index">${idx + 1}<span class="play-icon">‚ñ∂</span></div>
          <div class="song-info">
            <img class="song-cover-small" src="${imageUrl}" alt="" onerror="this.style.display='none'">
            <div class="song-details">
              <div class="song-name">${song.name || song.title}</div>
              <div class="song-artist">${artistNames}</div>
            </div>
          </div>
          <div class="song-album">${albumName}</div>
          <div class="song-duration">${formatDuration(song.duration)}</div>
        `;
        
        elements.songsList.appendChild(songRow);
      });
    }

    function displayAlbums() {
      elements.albumsGrid.innerHTML = "";
      
      appState.albums.forEach(album => {
        const card = document.createElement("div");
        card.className = "card";
        card.onclick = () => loadAlbumSongs(album.id);
        
        const imageUrl = getImageUrl(album.image, '500x500');
        const artistNames = album.artists && album.artists.primary 
          ? album.artists.primary.map(a => a.name).join(", ")
          : album.artist || 'Unknown Artist';
        
        card.innerHTML = `
          <img class="card-image" src="${imageUrl}" alt="${album.name || album.title}">
          <div class="card-title">${album.name || album.title}</div>
          <div class="card-subtitle">${artistNames}</div>
          <button class="card-play-btn" onclick="event.stopPropagation(); loadAlbumSongs('${album.id}')">‚ñ∂</button>
        `;
        
        elements.albumsGrid.appendChild(card);
      });
    }

    function displayArtists() {
      elements.artistsGrid.innerHTML = "";
      
      appState.artists.forEach(artist => {
        const card = document.createElement("div");
        card.className = "card";
        card.onclick = () => loadArtistSongs(artist.id);
        
        const imageUrl = getImageUrl(artist.image, '500x500');
        
        card.innerHTML = `
          <img class="card-image" src="${imageUrl}" alt="${artist.name || artist.title}" style="border-radius: 50%;">
          <div class="card-title">${artist.name || artist.title}</div>
          <div class="card-subtitle">Artist</div>
          <button class="card-play-btn" onclick="event.stopPropagation(); loadArtistSongs('${artist.id}')">‚ñ∂</button>
        `;
        
        elements.artistsGrid.appendChild(card);
      });
    }

    function displayPlaylists() {
      elements.playlistsGrid.innerHTML = "";
      
      appState.playlists.forEach(playlist => {
        const card = document.createElement("div");
        card.className = "card";
        card.onclick = () => loadPlaylistSongs(playlist.id);
        
        const imageUrl = getImageUrl(playlist.image, '500x500');
        
        card.innerHTML = `
          <img class="card-image" src="${imageUrl}" alt="${playlist.name || playlist.title}">
          <div class="card-title">${playlist.name || playlist.title}</div>
          <div class="card-subtitle">${playlist.songCount || 0} songs</div>
          <button class="card-play-btn" onclick="event.stopPropagation(); loadPlaylistSongs('${playlist.id}')">‚ñ∂</button>
        `;
        
        elements.playlistsGrid.appendChild(card);
      });
    }

    // Music Player Functions
    async function playSong(idx) {
      appState.currentIdx = idx;
      const song = appState.songs[appState.currentIdx];
      if (!song) return;
      
      try {
        // Get detailed song info with download URLs
        const response = await fetch(`${BASE_API_URL}/songs/${song.id}`);
        const data = await response.json();
        
        if (data.success && data.data && data.data.length > 0) {
          const detailedSong = data.data[0];
          appState.songs[idx] = { ...song, ...detailedSong };
          setupBottomPlayer(appState.songs[idx], true);
          setupAudioPlayer(appState.songs[idx]);
          updateActiveSong();
          addToRecent(appState.songs[idx]);
        }
      } catch (error) {
        console.error('Error loading song details:', error);
        setupBottomPlayer(song, false);
        updateActiveSong();
      }
    }

    function setupBottomPlayer(song, shouldPlay = false) {
      elements.bottomPlayer.style.display = 'grid';
      elements.nowPlayingCover.src = getImageUrl(song.image, '500x500');
      elements.nowPlayingName.textContent = song.name || song.title;
      
      const artistNames = song.artists && song.artists.primary 
        ? song.artists.primary.map(a => a.name).join(", ")
        : song.primaryArtists || 'Unknown Artist';
      elements.nowPlayingArtist.textContent = artistNames;
      
      appState.isPlaying = shouldPlay;
      elements.playPauseBtn.innerHTML = shouldPlay ? '‚è∏' : '‚ñ∂';
      
      // Update like button
      const isLiked = appState.likedSongs.some(likedSong => likedSong.id === song.id);
      elements.likeBtn.innerHTML = isLiked ? 'üíö' : '‚ô°';
      elements.likeBtn.classList.toggle('liked', isLiked);
    }

    function setupAudioPlayer(song) {
      if (!appState.audio) {
        appState.audio = document.getElementById("audioPlayer");
      }
      
      if (!appState.audio || !song.downloadUrl) return;
      
      let url = "";
      if (Array.isArray(song.downloadUrl)) {
        const high = song.downloadUrl.find(d => d.quality === "320kbps");
        url = high ? high.url : song.downloadUrl[song.downloadUrl.length - 1]?.url;
      }
      
      if (url) {
        appState.audio.src = url;
        appState.audio.volume = appState.isMuted ? 0 : appState.volume;
        appState.audio.onended = handleSongEnd;
        appState.audio.ontimeupdate = updateProgress;
        appState.audio.onloadedmetadata = () => {
          elements.totalTime.textContent = formatDuration(Math.floor(appState.audio.duration));
        };
        
        if (appState.isPlaying) {
          appState.audio.play().catch(console.error);
        }
      }
    }

    function updateActiveSong() {
      const songRows = document.querySelectorAll('.song-row');
      songRows.forEach((row, idx) => {
        if (idx === appState.currentIdx && appState.isPlaying) {
          row.classList.add('active', 'playing');
        } else {
          row.classList.remove('active', 'playing');
        }
      });
    }

    function togglePlay() {
      if (!appState.songs[appState.currentIdx]) return;
      
      appState.isPlaying = !appState.isPlaying;
      elements.playPauseBtn.innerHTML = appState.isPlaying ? '‚è∏' : '‚ñ∂';
      
      if (appState.audio) {
        if (appState.isPlaying) {
          appState.audio.play().catch(console.error);
        } else {
          appState.audio.pause();
        }
      }
      
      updateActiveSong();
    }

    function nextSong() {
      if (!appState.songs.length) return;
      
      if (appState.repeatMode === 2) {
        playSong(appState.currentIdx);
        return;
      }
      
      if (appState.isShuffled) {
        appState.currentIdx = Math.floor(Math.random() * appState.songs.length);
      } else {
        appState.currentIdx = (appState.currentIdx + 1) % appState.songs.length;
      }
      
      playSong(appState.currentIdx);
    }

    function prevSong() {
      if (!appState.songs.length) return;
      
      if (appState.isShuffled) {
        appState.currentIdx = Math.floor(Math.random() * appState.songs.length);
      } else {
        appState.currentIdx = (appState.currentIdx - 1 + appState.songs.length) % appState.songs.length;
      }
      
      playSong(appState.currentIdx);
    }

    function handleSongEnd() {
      if (appState.repeatMode === 1) {
        nextSong();
      } else if (appState.repeatMode === 2) {
        playSong(appState.currentIdx);
      } else {
        if (appState.currentIdx < appState.songs.length - 1) {
          nextSong();
        } else {
          appState.isPlaying = false;
          elements.playPauseBtn.innerHTML = '‚ñ∂';
          updateActiveSong();
        }
      }
    }

    // Control Functions
    function toggleShuffle() {
      appState.isShuffled = !appState.isShuffled;
      elements.shuffleBtn.style.color = appState.isShuffled ? '#1db954' : '#b3b3b3';
    }

    function toggleRepeat() {
      appState.repeatMode = (appState.repeatMode + 1) % 3;
      const colors = ['#b3b3b3', '#1db954', '#1db954'];
      const icons = ['üîÅ', 'üîÅ', 'üîÇ'];
      elements.repeatBtn.style.color = colors[appState.repeatMode];
      elements.repeatBtn.innerHTML = icons[appState.repeatMode];
    }

    function toggleLike() {
      const currentSong = appState.songs[appState.currentIdx];
      if (!currentSong) return;
      
      const likedIndex = appState.likedSongs.findIndex(song => song.id === currentSong.id);
      
      if (likedIndex === -1) {
        appState.likedSongs.unshift(currentSong);
        elements.likeBtn.innerHTML = 'üíö';
        elements.likeBtn.classList.add('liked');
      } else {
        appState.likedSongs.splice(likedIndex, 1);
        elements.likeBtn.innerHTML = '‚ô°';
        elements.likeBtn.classList.remove('liked');
      }
      
      updateSidebar();
    }

    function addToRecent(song) {
      const recentIndex = appState.recentSongs.findIndex(s => s.id === song.id);
      
      if (recentIndex !== -1) {
        appState.recentSongs.splice(recentIndex, 1);
      }
      
      appState.recentSongs.unshift(song);
      appState.recentSongs = appState.recentSongs.slice(0, 20);
      updateSidebar();
    }

    function updateProgress() {
      if (!appState.audio) return;
      
      const progress = (appState.audio.currentTime / appState.audio.duration) * 100;
      elements.progressFilled.style.width = progress + '%';
      elements.currentTime.textContent = formatDuration(Math.floor(appState.audio.currentTime));
    }

    function seek(event) {
      if (!appState.audio) return;
      
      const rect = event.target.getBoundingClientRect();
      const percent = (event.clientX - rect.left) / rect.width;
      appState.audio.currentTime = percent * appState.audio.duration;
    }

    function setVolume(event) {
      const rect = event.target.getBoundingClientRect();
      const percent = (event.clientX - rect.left) / rect.width;
      appState.volume = Math.max(0, Math.min(1, percent));
      
      elements.volumeFilled.style.width = (appState.volume * 100) + '%';
      
      if (appState.audio) {
        appState.audio.volume = appState.isMuted ? 0 : appState.volume;
      }
    }

    function toggleMute() {
      appState.isMuted = !appState.isMuted;
      
      if (appState.audio) {
        appState.audio.volume = appState.isMuted ? 0 : appState.volume;
      }
      
      document.querySelector('.volume-btn').innerHTML = appState.isMuted ? 'üîá' : 'üîä';
    }

    // View Management
    function switchView(view) {
      appState.currentView = view;
      
      // Update toggle buttons
      document.querySelectorAll('.toggle-btn').forEach(btn => btn.classList.remove('active'));
      document.getElementById(view + 'Toggle')?.classList.add('active');
      
      // Show/hide views
      document.querySelectorAll('.view-content').forEach(el => el.classList.add('hidden'));
      document.getElementById(view + 'View')?.classList.remove('hidden');
      
      loadDefaultContent();
    }

    // Load More Functions
    function loadMoreSongs() { loadSongs(true); }
    function loadMoreAlbums() { loadAlbums(true); }
    function loadMoreArtists() { loadArtists(true); }
    function loadMorePlaylists() { loadPlaylists(true); }

    function updateLoadMoreButton(type, hasMore) {
      const container = document.getElementById(`loadMore${type.charAt(0).toUpperCase() + type.slice(1)}Container`);
      if (container) {
        container.style.display = hasMore ? 'flex' : 'none';
      }
    }

    // Special Actions
    function playAll() {
      if (appState.songs.length > 0) {
        playSong(0);
      }
    }

    function shuffleAll() {
      if (appState.songs.length > 0) {
        appState.songs = [...appState.songs].sort(() => Math.random() - 0.5);
        displaySongs();
        playSong(0);
      }
    }

    function showLibrary() {
      appState.songs = [...appState.likedSongs];
      switchView('songs');
      elements.playlistTitle.textContent = 'Your Library';
      displaySongs();
    }

    function showSearch() {
      elements.searchInput.focus();
    }

    function updateSidebar() {
      // Update recently played
      elements.recentlyPlayedList.innerHTML = "";
      appState.recentSongs.slice(0, 5).forEach(song => {
        const item = document.createElement("div");
        item.className = "sidebar-item";
        item.innerHTML = `<span>üéµ</span> ${song.name || song.title}`;
        item.onclick = () => {
          const songIndex = appState.songs.findIndex(s => s.id === song.id);
          if (songIndex !== -1) playSong(songIndex);
        };
        elements.recentlyPlayedList.appendChild(item);
      });

      // Update liked songs
      elements.likedSongsList.innerHTML = "";
      appState.likedSongs.slice(0, 5).forEach(song => {
        const item = document.createElement("div");
        item.className = "sidebar-item";
        item.innerHTML = `<span>üíö</span> ${song.name || song.title}`;
        item.onclick = () => {
          const songIndex = appState.songs.findIndex(s => s.id === song.id);
          if (songIndex !== -1) playSong(songIndex);
        };
        elements.likedSongsList.appendChild(item);
      });
    }

    // Utility Functions
    function getRandomQuery(type) {
      const queries = {
        songs: {
          tamil: ['ar rahman tamil', 'ilaiyaraaja', 'anirudh tamil', 'harris jayaraj', 'yuvan shankar raja'],
          hindi: ['arijit singh', 'kishore kumar', 'lata mangeshkar', 'bollywood hits'],
          telugu: ['ss thaman', 'devi sri prasad', 'mm keeravani', 'telugu hits'],
          malayalam: ['ilaiyaraaja malayalam', 'vidyasagar', 'shaan rahman', 'malayalam hits'],
          kannada: ['hamsalekha', 'v harikrishna', 'arjun janya', 'kannada hits'],
          english: ['pop hits', 'rock classics', 'billboard hits']
        },
        albums: {
          tamil: ['tamil albums', 'kollywood music'],
          hindi: ['bollywood albums', 'hindi movie music'],
          telugu: ['tollywood music', 'telugu albums'],
          malayalam: ['mollywood music', 'malayalam albums'],
          kannada: ['sandalwood music', 'kannada albums'],
          english: ['english albums', 'western music']
        },
        artists: {
          tamil: ['tamil singers', 'kollywood artists'],
          hindi: ['bollywood singers', 'hindi artists'],
          telugu: ['telugu singers', 'tollywood artists'],
          malayalam: ['malayalam singers', 'mollywood artists'],
          kannada: ['kannada singers', 'sandalwood artists'],
          english: ['english artists', 'pop artists']
        },
        playlists: {
          tamil: ['tamil playlist', 'kollywood hits'],
          hindi: ['bollywood playlist', 'hindi hits'],
          telugu: ['telugu playlist', 'tollywood hits'],
          malayalam: ['malayalam playlist', 'mollywood hits'],
          kannada: ['kannada playlist', 'sandalwood hits'],
          english: ['english playlist', 'pop playlist']
        }
      };

      const langQueries = queries[type][appState.currentLanguage] || queries[type]['tamil'];
      return langQueries[Math.floor(Math.random() * langQueries.length)];
    }

    function showLoading(elementId) {
      const element = document.getElementById(elementId);
      if (element) {
        element.innerHTML = `
          <div class="loading">
            <div class="loading-spinner"></div>
            <div>Loading...</div>
          </div>
        `;
      }
    }

    function showError(message, elementId) {
      const element = elementId ? document.getElementById(elementId) : null;
      if (element) {
        element.innerHTML = `
          <div class="error">
            <div class="error-title">Oops! Something went wrong</div>
            <div class="error-message">${message}</div>
          </div>
        `;
      } else {
        console.error(message);
      }
    }

    function formatDuration(seconds) {
      if (!seconds || isNaN(seconds)) return "0:00";
      const mins = Math.floor(seconds / 60);
      const secs = Math.floor(seconds % 60).toString().padStart(2, "0");
      return `${mins}:${secs}`;
    }

    function getImageUrl(imageArray, quality) {
      if (!imageArray || !imageArray.length) {
        return "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='300' height='300' viewBox='0 0 300 300'%3E%3Crect width='300' height='300' fill='%23282828'/%3E%3Ctext x='50%25' y='50%25' font-family='Arial' font-size='14' fill='%23b3b3b3' text-anchor='middle' dy='.3em'%3ENo Image%3C/text%3E%3C/svg%3E";
      }
      
      if (typeof imageArray === 'string') return imageArray;
      
      const targetImage = imageArray.find(img => img.quality === quality);
      return targetImage ? targetImage.url : imageArray[0].url;
    }

    // Global functions for onclick handlers
    window.switchView = switchView;
    window.togglePlay = togglePlay;
    window.nextSong = nextSong;
    window.prevSong = prevSong;
    window.toggleShuffle = toggleShuffle;
    window.toggleRepeat = toggleRepeat;
    window.toggleLike = toggleLike;
    window.toggleMute = toggleMute;
    window.seek = seek;
    window.setVolume = setVolume;
    window.loadMoreSongs = loadMoreSongs;
    window.loadMoreAlbums = loadMoreAlbums;
    window.loadMoreArtists = loadMoreArtists;
    window.loadMorePlaylists = loadMorePlaylists;
    window.playAll = playAll;
    window.shuffleAll = shuffleAll;
    window.loadSuggestions = loadSuggestions;
    window.showLibrary = showLibrary;
    window.showSearch = showSearch;
    window.loadAlbumSongs = loadAlbumSongs;
    window.loadArtistSongs = loadArtistSongs;
    window.loadPlaylistSongs = loadPlaylistSongs;

    // Enhanced functionality
    function setupKeyboardShortcuts() {
      document.addEventListener('keydown', function(e) {
        if (e.target === elements.searchInput) return;
        
        switch(e.code) {
          case 'Space':
            e.preventDefault();
            togglePlay();
            break;
          case 'ArrowRight':
            if (e.ctrlKey || e.metaKey) {
              e.preventDefault();
              nextSong();
            }
            break;
          case 'ArrowLeft':
            if (e.ctrlKey || e.metaKey) {
              e.preventDefault();
              prevSong();
            }
            break;
        }
      });
    }

    // Initialize keyboard shortcuts
    document.addEventListener('DOMContentLoaded', function() {
      setupKeyboardShortcuts();
    });

    // Auto-update UI periodically
    setInterval(() => {
      if (appState.songs.length && elements.songsCount) {
        elements.songsCount.textContent = appState.songs.length;
      }
    }, 5000);

    // Handle offline/online status
    window.addEventListener('online', () => {
      console.log('App is back online');
    });

    window.addEventListener('offline', () => {
      console.log('App is offline - some features may be limited');
    });

    // Enhanced error handling for fetch requests
    function handleFetchError(error) {
      if (error.name === 'TypeError' && error.message.includes('Failed to fetch')) {
        return 'Network error. Please check your internet connection.';
      } else if (error.message.includes('404')) {
        return 'Content not found. Please try a different search.';
      } else if (error.message.includes('500')) {
        return 'Server error. Please try again later.';
      } else {
        return 'Something went wrong. Please try again.';
      }
    }

    // Performance optimization: Debounce scroll events
    let scrollTimeout;
    document.addEventListener('scroll', () => {
      clearTimeout(scrollTimeout);
      scrollTimeout = setTimeout(() => {
        // Handle scroll events if needed
      }, 100);
    }, { passive: true });

    // Initialize the app with default content
    setTimeout(() => {
      if (appState.songs.length === 0) {
        loadDefaultContent();
      }
    }, 100);
  </script>
</body>
</html>
