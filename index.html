<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0"/>
  <title>Tamil Music - Spotify</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      background: #121212;
      color: #ffffff;
      font-family: 'Helvetica Neue', Arial, sans-serif;
      height: 100vh;
      overflow: hidden;
      display: flex;
      flex-direction: column;
    }
    
    /* Top Navigation */
    .top-nav {
      background: #121212;
      padding: 16px 24px;
      border-bottom: 1px solid #282828;
      display: flex;
      align-items: center;
      gap: 16px;
      z-index: 100;
    }
    
    .nav-buttons {
      display: flex;
      gap: 8px;
    }
    
    .nav-btn {
      width: 32px;
      height: 32px;
      border-radius: 50%;
      background: #0a0a0a;
      border: none;
      color: #ffffff;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 18px;
      transition: background 0.2s;
    }
    
    .nav-btn:hover {
      background: #1a1a1a;
    }
    
    .nav-btn:disabled {
      opacity: 0.4;
      cursor: not-allowed;
    }
    
    .language-dropdown {
      position: relative;
    }
    
    .language-select {
      background: #242424;
      border: 1px solid #404040;
      border-radius: 20px;
      padding: 8px 16px;
      color: #ffffff;
      font-size: 14px;
      cursor: pointer;
      min-width: 120px;
      transition: background 0.2s;
    }
    
    .language-select:hover {
      background: #2a2a2a;
    }
    
    .language-select:focus {
      outline: none;
      border-color: #1db954;
    }
    
    .search-bar {
      flex: 1;
      max-width: 400px;
      position: relative;
    }
    
    .search-input {
      width: 100%;
      background: #242424;
      border: none;
      border-radius: 24px;
      padding: 12px 16px 12px 48px;
      color: #ffffff;
      font-size: 14px;
      transition: background 0.2s;
    }
    
    .search-input:focus {
      outline: none;
      background: #2a2a2a;
    }
    
    .search-icon {
      position: absolute;
      left: 16px;
      top: 50%;
      transform: translateY(-50%);
      color: #b3b3b3;
      font-size: 16px;
    }
    
    /* Main Content */
    .main-content {
      flex: 1;
      display: flex;
      overflow: hidden;
    }
    
    /* Sidebar */
    .sidebar {
      width: 280px;
      background: #121212;
      border-right: 1px solid #282828;
      display: flex;
      flex-direction: column;
    }
    
    .sidebar-header {
      padding: 24px;
      border-bottom: 1px solid #282828;
    }
    
    .logo {
      height: 32px;
      margin-bottom: 20px;
    }
    
    .sidebar-nav {
      padding: 8px 0;
    }
    
    .sidebar-item {
      padding: 12px 24px;
      color: #b3b3b3;
      font-weight: 500;
      font-size: 14px;
      cursor: pointer;
      transition: color 0.2s;
      display: flex;
      align-items: center;
      gap: 16px;
    }
    
    .sidebar-item.active {
      color: #ffffff;
    }
    
    .sidebar-item:hover {
      color: #ffffff;
    }
    
    /* Main View */
    .main-view {
      flex: 1;
      background: linear-gradient(180deg, #1e3264 0%, #121212 300px);
      overflow-y: auto;
      padding: 24px;
      padding-bottom: 120px; /* Space for bottom player */
    }
    
    .playlist-header {
      margin-bottom: 32px;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }
    
    .playlist-title {
      font-size: 48px;
      font-weight: 900;
      margin-bottom: 8px;
    }
    
    .playlist-info {
      flex: 1;
    }
    
    .playlist-meta {
      color: #b3b3b3;
      font-size: 14px;
    }
    
    .playlist-actions {
      display: flex;
      gap: 16px;
      align-items: center;
    }
    
    .play-all-btn {
      width: 56px;
      height: 56px;
      border-radius: 50%;
      background: #1db954;
      border: none;
      color: #000000;
      font-size: 20px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: transform 0.2s, background 0.2s;
    }
    
    .play-all-btn:hover {
      transform: scale(1.04);
      background: #1ed760;
    }
    
    .shuffle-btn {
      background: none;
      border: 2px solid #b3b3b3;
      border-radius: 24px;
      padding: 8px 16px;
      color: #b3b3b3;
      cursor: pointer;
      font-size: 14px;
      font-weight: 600;
      transition: all 0.2s;
    }
    
    .shuffle-btn:hover {
      border-color: #ffffff;
      color: #ffffff;
    }
    
    /* Songs Table */
    .songs-table {
      width: 100%;
    }
    
    .songs-header {
      display: grid;
      grid-template-columns: 16px 1fr 1fr auto;
      gap: 16px;
      padding: 8px 16px;
      border-bottom: 1px solid #282828;
      margin-bottom: 16px;
      font-size: 12px;
      color: #b3b3b3;
      font-weight: 500;
      text-transform: uppercase;
    }
    
    .song-row {
      display: grid;
      grid-template-columns: 16px 1fr 1fr auto;
      gap: 16px;
      padding: 8px 16px;
      border-radius: 4px;
      cursor: pointer;
      transition: background 0.2s;
      align-items: center;
      min-height: 56px;
    }
    
    .song-row:hover {
      background: #1a1a1a;
    }
    
    .song-row.active {
      background: #1a1a1a;
    }
    
    .song-row.playing .song-name {
      color: #1db954;
    }
    
    .song-index {
      color: #b3b3b3;
      font-size: 14px;
      text-align: center;
    }
    
    .song-row:hover .song-index {
      display: none;
    }
    
    .song-row:hover .play-icon {
      display: block;
    }
    
    .play-icon {
      display: none;
      color: #ffffff;
      font-size: 16px;
      text-align: center;
    }
    
    .song-info {
      display: flex;
      align-items: center;
      gap: 12px;
    }
    
    .song-cover-small {
      width: 40px;
      height: 40px;
      border-radius: 4px;
      object-fit: cover;
      background: #282828;
    }
    
    .song-details {
      min-width: 0;
    }
    
    .song-name {
      font-size: 16px;
      font-weight: 500;
      color: #ffffff;
      margin-bottom: 2px;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }
    
    .song-artist {
      font-size: 14px;
      color: #b3b3b3;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }
    
    .song-album {
      color: #b3b3b3;
      font-size: 14px;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }
    
    .song-duration {
      color: #b3b3b3;
      font-size: 14px;
    }
    
    .load-more-container {
      display: flex;
      justify-content: center;
      margin: 32px 0;
    }
    
    .load-more-btn {
      background: none;
      border: 2px solid #b3b3b3;
      border-radius: 24px;
      padding: 12px 32px;
      color: #b3b3b3;
      cursor: pointer;
      font-size: 14px;
      font-weight: 600;
      transition: all 0.2s;
    }
    
    .load-more-btn:hover {
      border-color: #ffffff;
      color: #ffffff;
      transform: scale(1.02);
    }
    
    .load-more-btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }
    
    /* Bottom Player */
    .bottom-player {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      background: #181818;
      border-top: 1px solid #282828;
      padding: 12px 16px;
      display: grid;
      grid-template-columns: 1fr 2fr 1fr;
      gap: 16px;
      align-items: center;
      z-index: 1000;
      height: 90px;
    }
    
    .now-playing {
      display: flex;
      align-items: center;
      gap: 12px;
      min-width: 0;
    }
    
    .now-playing-cover {
      width: 56px;
      height: 56px;
      border-radius: 4px;
      object-fit: cover;
      background: #282828;
      flex-shrink: 0;
    }
    
    .now-playing-info {
      min-width: 0;
      flex: 1;
    }
    
    .now-playing-name {
      font-size: 14px;
      font-weight: 500;
      color: #ffffff;
      margin-bottom: 2px;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }
    
    .now-playing-artist {
      font-size: 12px;
      color: #b3b3b3;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }
    
    .like-btn {
      background: none;
      border: none;
      color: #b3b3b3;
      cursor: pointer;
      padding: 8px;
      margin-left: 8px;
      border-radius: 50%;
      transition: color 0.2s;
    }
    
    .like-btn:hover {
      color: #ffffff;
    }
    
    .player-controls {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 8px;
    }
    
    .control-buttons {
      display: flex;
      align-items: center;
      gap: 16px;
    }
    
    .control-btn {
      background: none;
      border: none;
      color: #b3b3b3;
      cursor: pointer;
      padding: 8px;
      border-radius: 50%;
      transition: color 0.2s, transform 0.2s;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    .control-btn:hover {
      color: #ffffff;
      transform: scale(1.06);
    }
    
    .play-pause-btn {
      width: 32px;
      height: 32px;
      background: #ffffff;
      color: #000000;
      font-size: 12px;
    }
    
    .play-pause-btn:hover {
      background: #ffffff;
      color: #000000;
      transform: scale(1.06);
    }
    
    .progress-bar {
      display: flex;
      align-items: center;
      gap: 8px;
      width: 100%;
      max-width: 600px;
    }
    
    .time-display {
      font-size: 11px;
      color: #b3b3b3;
      min-width: 40px;
      text-align: center;
    }
    
    .progress-track {
      flex: 1;
      height: 4px;
      background: #4f4f4f;
      border-radius: 2px;
      cursor: pointer;
      position: relative;
    }
    
    .progress-filled {
      height: 100%;
      background: #ffffff;
      border-radius: 2px;
      width: 30%;
      transition: width 0.1s;
    }
    
    .volume-controls {
      display: flex;
      align-items: center;
      gap: 8px;
      justify-self: end;
    }
    
    .volume-btn {
      background: none;
      border: none;
      color: #b3b3b3;
      cursor: pointer;
      padding: 8px;
    }
    
    .volume-slider {
      width: 100px;
      height: 4px;
      background: #4f4f4f;
      border-radius: 2px;
      cursor: pointer;
    }
    
    .loading {
      display: flex;
      justify-content: center;
      align-items: center;
      height: 200px;
      color: #b3b3b3;
      flex-direction: column;
      gap: 16px;
    }
    
    .loading-spinner {
      width: 32px;
      height: 32px;
      border: 3px solid #333;
      border-top: 3px solid #1db954;
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }
    
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    
    .error {
      display: flex;
      justify-content: center;
      align-items: center;
      height: 200px;
      color: #f77;
    }
    
    /* Responsive */
    @media (max-width: 768px) {
      .sidebar {
        display: none;
      }
      
      .bottom-player {
        grid-template-columns: 1fr auto;
      }
      
      .volume-controls {
        display: none;
      }
      
      .playlist-header {
        flex-direction: column;
        align-items: flex-start;
        gap: 16px;
      }
      
      .playlist-title {
        font-size: 32px;
      }
    }
    
    /* Scrollbar */
    ::-webkit-scrollbar {
      width: 12px;
    }
    
    ::-webkit-scrollbar-track {
      background: #121212;
    }
    
    ::-webkit-scrollbar-thumb {
      background: #333333;
      border-radius: 6px;
    }
    
    ::-webkit-scrollbar-thumb:hover {
      background: #444444;
    }
  </style>
</head>
<body>
  <!-- Top Navigation -->
  <nav class="top-nav">
    <div class="nav-buttons">
      <button class="nav-btn" onclick="history.back()" title="Go back">‚Äπ</button>
      <button class="nav-btn" onclick="history.forward()" title="Go forward">‚Ä∫</button>
    </div>
    
    <div class="language-dropdown">
      <select class="language-select" id="languageSelect">
        <option value="tamil">Tamil</option>
        <option value="hindi">Hindi</option>
        <option value="telugu">Telugu</option>
        <option value="malayalam">Malayalam</option>
        <option value="kannada">Kannada</option>
        <option value="bengali">Bengali</option>
        <option value="punjabi">Punjabi</option>
        <option value="marathi">Marathi</option>
        <option value="gujarati">Gujarati</option>
        <option value="english">English</option>
      </select>
    </div>
    
    <div class="search-bar">
      <span class="search-icon">üîç</span>
      <input type="text" class="search-input" id="searchInput" placeholder="Search for songs, artists, or albums">
    </div>
  </nav>

  <!-- Main Content -->
  <div class="main-content">
    <!-- Sidebar -->
    <div class="sidebar">
      <div class="sidebar-header">
        <img src="https://storage.googleapis.com/pr-newsroom-wp/1/2018/11/Spotify_Logo_CMYK_White.png" alt="Spotify" class="logo">
      </div>
      <nav class="sidebar-nav">
        <div class="sidebar-item active">
          <span>üè†</span> Home
        </div>
        <div class="sidebar-item">
          <span>üîç</span> Search
        </div>
        <div class="sidebar-item">
          <span>üìö</span> Your Library
        </div>
      </nav>
    </div>

    <!-- Main View -->
    <div class="main-view" id="mainView">
      <div class="playlist-header">
        <div class="playlist-info">
          <h1 class="playlist-title" id="playlistTitle">Tamil Songs</h1>
          <div class="playlist-meta">
            <span id="songsCount">Loading...</span> songs ‚Ä¢ Made for you
          </div>
        </div>
        <div class="playlist-actions">
          <button class="play-all-btn" onclick="playAll()" title="Play all">‚ñ∂</button>
          <button class="shuffle-btn" onclick="shuffleAll()">Shuffle play</button>
        </div>
      </div>

      <div class="songs-table">
        <div class="songs-header">
          <span>#</span>
          <span>Title</span>
          <span>Album</span>
          <span>‚è±</span>
        </div>
        <div id="songsList"></div>
      </div>
      
      <div class="load-more-container" id="loadMoreContainer" style="display: none;">
        <button class="load-more-btn" id="loadMoreBtn" onclick="loadMoreSongs()">Load More Songs</button>
      </div>
    </div>
  </div>

  <!-- Bottom Player -->
  <div class="bottom-player" id="bottomPlayer" style="display: none;">
    <div class="now-playing">
      <img class="now-playing-cover" id="nowPlayingCover" src="" alt="">
      <div class="now-playing-info">
        <div class="now-playing-name" id="nowPlayingName">Select a song</div>
        <div class="now-playing-artist" id="nowPlayingArtist">Artist</div>
      </div>
      <button class="like-btn" title="Add to Liked Songs">‚ô°</button>
    </div>

    <div class="player-controls">
      <div class="control-buttons">
        <button class="control-btn" onclick="shuffle()" title="Shuffle">üîÄ</button>
        <button class="control-btn" onclick="prevSong()" title="Previous">‚èÆ</button>
        <button class="control-btn play-pause-btn" id="playPauseBtn" onclick="togglePlay()">‚ñ∂</button>
        <button class="control-btn" onclick="nextSong()" title="Next">‚è≠</button>
        <button class="control-btn" onclick="repeat()" title="Repeat">üîÅ</button>
      </div>
      <div class="progress-bar">
        <span class="time-display" id="currentTime">0:00</span>
        <div class="progress-track" onclick="seek(event)">
          <div class="progress-filled" id="progressFilled"></div>
        </div>
        <span class="time-display" id="totalTime">0:00</span>
      </div>
    </div>

    <div class="volume-controls">
      <button class="volume-btn">üîä</button>
      <div class="volume-slider"></div>
    </div>
  </div>

  <audio id="audioPlayer" style="display: none;"></audio>

  <script>
    const API_URL = "https://jiosavan-api-with-playlist.vercel.app/api/search/songs?query=";
    
    let songs = [];
    let displayedSongs = [];
    let currentIdx = 0;
    let isPlaying = false;
    let audio = null;
    let currentLanguage = 'tamil';
    let songsPerPage = 25;
    let currentPage = 0;
    let isLoading = false;

    const songsListDiv = document.getElementById("songsList");
    const searchInput = document.getElementById("searchInput");
    const languageSelect = document.getElementById("languageSelect");
    const bottomPlayer = document.getElementById("bottomPlayer");
    const nowPlayingCover = document.getElementById("nowPlayingCover");
    const nowPlayingName = document.getElementById("nowPlayingName");
    const nowPlayingArtist = document.getElementById("nowPlayingArtist");
    const playPauseBtn = document.getElementById("playPauseBtn");
    const currentTime = document.getElementById("currentTime");
    const totalTime = document.getElementById("totalTime");
    const progressFilled = document.getElementById("progressFilled");
    const songsCount = document.getElementById("songsCount");
    const playlistTitle = document.getElementById("playlistTitle");
    const loadMoreContainer = document.getElementById("loadMoreContainer");
    const loadMoreBtn = document.getElementById("loadMoreBtn");

    // Language change handler
    languageSelect.addEventListener('change', function() {
      currentLanguage = this.value;
      const languageName = this.options[this.selectedIndex].text;
      playlistTitle.textContent = `${languageName} Songs`;
      resetAndFetchSongs();
    });

    // Search handler
    let searchTimeout;
    searchInput.addEventListener('input', function() {
      clearTimeout(searchTimeout);
      searchTimeout = setTimeout(() => {
        if (this.value.trim()) {
          resetAndFetchSongs(this.value.trim());
        } else {
          resetAndFetchSongs();
        }
      }, 500);
    });

    function resetAndFetchSongs(query) {
      songs = [];
      displayedSongs = [];
      currentPage = 0;
      songsListDiv.innerHTML = '';
      loadMoreContainer.style.display = 'none';
      fetchSongs(query);
    }

    function fetchSongs(query, append = false) {
      if (isLoading) return;
      isLoading = true;

      if (!append) {
        songsListDiv.innerHTML = `
          <div class="loading">
            <div class="loading-spinner"></div>
            <div>Loading ${currentLanguage} songs...</div>
          </div>
        `;
      } else {
        loadMoreBtn.disabled = true;
        loadMoreBtn.textContent = 'Loading...';
      }

      const searchQuery = query || getRandomQueries();
      
      fetch(`${API_URL}${encodeURIComponent(searchQuery)}&limit=100`)
        .then(res => res.json())
        .then(json => {
          const newSongs = (json.data.results || []).filter(
            s => s.language && s.language.toLowerCase() === currentLanguage.toLowerCase()
          ) || [];

          if (append) {
            // Add new unique songs
            newSongs.forEach(newSong => {
              const exists = songs.some(existingSong => existingSong.id === newSong.id);
              if (!exists) {
                songs.push(newSong);
              }
            });
          } else {
            songs = newSongs;
          }

          // If we don't have enough songs, fetch more with different queries
          if (songs.length < 100 && !query) {
            fetchMoreFromDifferentSources();
          } else {
            displaySongs();
          }

          isLoading = false;
        })
        .catch(error => {
          console.error('Error fetching songs:', error);
          if (!append) {
            songsListDiv.innerHTML = '<div class="error">Failed to load songs. Please try again.</div>';
          }
          isLoading = false;
          loadMoreBtn.disabled = false;
          loadMoreBtn.textContent = 'Load More Songs';
        });
    }

    function fetchMoreFromDifferentSources() {
      const additionalQueries = getAdditionalQueries();
      let fetchCount = 0;
      
      additionalQueries.forEach((query, index) => {
        setTimeout(() => {
          fetch(`${API_URL}${encodeURIComponent(query)}&limit=50`)
            .then(res => res.json())
            .then(json => {
              const newSongs = (json.data.results || []).filter(
                s => s.language && s.language.toLowerCase() === currentLanguage.toLowerCase()
              ) || [];

              newSongs.forEach(newSong => {
                const exists = songs.some(existingSong => existingSong.id === newSong.id);
                if (!exists) {
                  songs.push(newSong);
                }
              });

              fetchCount++;
              if (fetchCount === additionalQueries.length) {
                displaySongs();
              }
            })
            .catch(console.error);
        }, index * 200); // Stagger requests
      });
    }

    function getRandomQueries() {
      const queries = {
        tamil: ['tamil hits', 'tamil melody', 'ar rahman tamil', 'tamil classical', 'ilaiyaraaja'],
        hindi: ['bollywood hits', 'hindi romantic', 'hindi classical', 'arijit singh', 'kishore kumar'],
        telugu: ['telugu hits', 'telugu melody', 'ss thaman telugu', 'telugu classical', 'spb telugu'],
        malayalam: ['malayalam hits', 'malayalam melody', 'malayalam classical', 'yesudas malayalam'],
        kannada: ['kannada hits', 'kannada melody', 'kannada classical', 'spb kannada'],
        bengali: ['bengali hits', 'rabindra sangeet', 'bengali modern', 'bengali classical'],
        punjabi: ['punjabi hits', 'punjabi bhangra', 'punjabi romantic', 'gurdas maan'],
        marathi: ['marathi hits', 'marathi classical', 'marathi folk', 'marathi devotional'],
        gujarati: ['gujarati hits', 'gujarati folk', 'gujarati bhajan', 'gujarati garba'],
        english: ['pop hits', 'rock classics', 'english romantic', 'billboard hits']
      };

      const langQueries = queries[currentLanguage] || queries.tamil;
      return langQueries[Math.floor(Math.random() * langQueries.length)];
    }

    function getAdditionalQueries() {
      const additionalQueries = {
        tamil: ['vijay songs tamil', 'ajith songs tamil', 'tamil duet songs', 'tamil sad songs'],
        hindi: ['shah rukh khan songs', 'hindi party songs', 'hindi sad songs', '90s bollywood'],
        telugu: ['mahesh babu songs', 'prabhas songs', 'telugu item songs', 'telugu devotional'],
        malayalam: ['mohanlal songs', 'mammootty songs', 'malayalam romantic', 'malayalam folk'],
        kannada: ['rajkumar songs', 'kannada romantic', 'kannada devotional', 'kannada folk'],
        bengali: ['bengali romantic', 'bengali devotional', 'adhunik bengali', 'bengali folk'],
        punjabi: ['diljit dosanjh', 'punjabi sad songs', 'punjabi dance', 'punjabi folk'],
        marathi: ['marathi romantic', 'marathi qawwali', 'marathi lavani', 'marathi abhang'],
        gujarati: ['gujarati romantic', 'gujarati devotional', 'gujarati lok geet', 'gujarati thumri'],
        english: ['english dance', 'english ballads', 'english rock', 'english country']
      };

      return additionalQueries[currentLanguage] || additionalQueries.tamil;
    }

    function displaySongs() {
      const startIndex = currentPage * songsPerPage;
      const endIndex = Math.min(startIndex + songsPerPage, songs.length);
      const songsToShow = songs.slice(startIndex, endIndex);

      if (currentPage === 0) {
        displayedSongs = [...songsToShow];
        songsListDiv.innerHTML = "";
      } else {
        displayedSongs = [...displayedSongs, ...songsToShow];
      }

      songsToShow.forEach((song, idx) => {
        const globalIndex = startIndex + idx;
        const songRow = document.createElement("div");
        songRow.className = "song-row" + (globalIndex === currentIdx && isPlaying ? " active playing" : "");
        songRow.onclick = () => playSong(globalIndex);
        
        songRow.innerHTML = `
          <div class="song-index">${globalIndex + 1}<span class="play-icon">‚ñ∂</span></div>
          <div class="song-info">
            <img class="song-cover-small" src="${getImg(song, '150x150')}" alt="" onerror="this.style.display='none'">
            <div class="song-details">
              <div class="song-name">${song.name}</div>
              <div class="song-artist">${song.artists.primary.map(a => a.name).join(", ")}</div>
            </div>
          </div>
          <div class="song-album">${song.album.name}</div>
          <div class="song-duration">${formatDuration(song.duration)}</div>
        `;
        
        songsListDiv.appendChild(songRow);
      });

      // Update counts and show/hide load more button
      songsCount.textContent = displayedSongs.length;
      
      if (songs.length > displayedSongs.length) {
        loadMoreContainer.style.display = 'flex';
        loadMoreBtn.disabled = false;
        loadMoreBtn.textContent = 'Load More Songs';
      } else if (songs.length < 100) {
        loadMoreContainer.style.display = 'flex';
        loadMoreBtn.disabled = false;
        loadMoreBtn.textContent = 'Load More Songs';
      } else {
        loadMoreContainer.style.display = 'none';
      }
    }

    function loadMoreSongs() {
      if (displayedSongs.length < songs.length) {
        // Show more from existing songs
        currentPage++;
        displaySongs();
      } else {
        // Fetch more songs
        fetchSongs(null, true);
      }
    }

    function playSong(idx) {
      currentIdx = idx;
      isPlaying = true;
      
      const song = songs[currentIdx];
      
      // Update bottom player
      bottomPlayer.style.display = 'grid';
      nowPlayingCover.src = getImg(song, '500x500');
      nowPlayingName.textContent = song.name;
      nowPlayingArtist.textContent = song.artists.primary.map(a => a.name).join(", ");
      playPauseBtn.innerHTML = '‚è∏';
      
      // Update songs list
      updateActiveSong();
      
      // Setup audio
      setupAudioPlayer(song);
    }

    function updateActiveSong() {
      const songRows = document.querySelectorAll('.song-row');
      songRows.forEach((row, idx) => {
        if (idx === currentIdx && isPlaying) {
          row.classList.add('active', 'playing');
        } else {
          row.classList.remove('active', 'playing');
        }
      });
    }

    function setupAudioPlayer(song) {
      audio = document.getElementById("audioPlayer");
      if (!audio) return;
      
      let url = "";
      if (song.downloadUrl && Array.isArray(song.downloadUrl)) {
        let high = song.downloadUrl.find(d => d.quality === "320kbps");
        url = high ? high.url : song.downloadUrl[song.downloadUrl.length - 1]?.url;
      }
      
      if (url) {
        audio.src = url;
        audio.onended = nextSong;
        audio.ontimeupdate = updateProgress;
        audio.onloadedmetadata = () => {
          totalTime.textContent = formatDuration(Math.floor(audio.duration));
        };
        
        if (isPlaying) {
          audio.play().catch(console.error);
        }
      }
    }

    function togglePlay() {
      if (!songs[currentIdx]) return;
      
      isPlaying = !isPlaying;
      playPauseBtn.innerHTML = isPlaying ? '‚è∏' : '‚ñ∂';
      
      if (audio) {
        if (isPlaying) {
          audio.play().catch(console.error);
        } else {
          audio.pause();
        }
      }
      
      updateActiveSong();
    }

    function nextSong() {
      if (!songs.length) return;
      currentIdx = (currentIdx + 1) % songs.length;
      playSong(currentIdx);
    }

    function prevSong() {
      if (!songs.length) return;
      currentIdx = (currentIdx - 1 + songs.length) % songs.length;
      playSong(currentIdx);
    }

    function playAll() {
      if (songs.length > 0) {
        playSong(0);
      }
    }

    function shuffleAll() {
      if (songs.length > 0) {
        // Shuffle the songs array
        const shuffled = [...songs].sort(() => Math.random() - 0.5);
        songs = shuffled;
        displayedSongs = [];
        currentPage = 0;
        displaySongs();
        playSong(0);
      }
    }

    function updateProgress() {
      if (!audio) return;
      
      const progress = (audio.currentTime / audio.duration) * 100;
      progressFilled.style.width = progress + '%';
      currentTime.textContent = formatDuration(Math.floor(audio.currentTime));
    }

    function seek(event) {
      if (!audio) return;
      
      const rect = event.target.getBoundingClientRect();
      const percent = (event.clientX - rect.left) / rect.width;
      audio.currentTime = percent * audio.duration;
    }

    function shuffle() {
      console.log('Shuffle clicked');
    }

    function repeat() {
      console.log('Repeat clicked');
    }

    function formatDuration(seconds) {
      if (!seconds || isNaN(seconds)) return "0:00";
      const mins = Math.floor(seconds / 60);
      const secs = Math.floor(seconds % 60).toString().padStart(2, "0");
      return `${mins}:${secs}`;
    }

    function getImg(song, quality) {
      if (!song.image || !song.image.length) return "";
      return song.image.find(img => img.quality === quality)?.url || song.image[0].url;
    }

    // Make functions globally available
    window.togglePlay = togglePlay;
    window.nextSong = nextSong;
    window.prevSong = prevSong;
    window.shuffle = shuffle;
    window.repeat = repeat;
    window.seek = seek;
    window.loadMoreSongs = loadMoreSongs;
    window.playAll = playAll;
    window.shuffleAll = shuffleAll;

    // Initial load
    fetchSongs();
  </script>
</body>
</html>
